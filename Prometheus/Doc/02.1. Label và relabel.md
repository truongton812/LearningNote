Khi khai báo một target trong Prometheus (ví dụ trong static_configs), Prometheus sẽ tự động thêm một số label mặc định cho target đó​

- __address__: địa chỉ IP:port của target (ví dụ: 10.10.10.10:9100).
- __scheme__: scheme dùng để scrape, thường là http hoặc https.
- __metrics_path__: đường dẫn metrics, mặc định là /metrics.
- job: tên job được khai báo trong job_name (ví dụ: node_exporter, prometheus)
- instance: mặc định bằng giá trị của __address__ (tức là IP:port).
​

Ví dụ, với cấu hình như sau thì target này sẽ có các label mặc định:
```
- job_name: 'node'
  metrics_path: '/custom-metrics'  # ← Override mặc định /metrics
  scheme: https                    # ← Override mặc định http
  static_configs:
    - targets: ['10.10.10.10:9100']
```

```
__address__ = "10.10.10.10:9100"
__scheme__ = "http"
__metrics_path__ = "/metrics"
job = "node"
instance = "10.10.10.10:9100"
```


Ngoài các label mặc định, có thể thêm label tùy ý bằng cách dùng labels trong static_configs để thêm label chung cho cả nhóm target. VD
```
- job_name: 'node'
  static_configs:
    - targets: ['10.10.10.10:9100', '10.10.10.11:9100']
      labels:
        env: production
        team: devops
```
→ Các target trong nhóm này sẽ có thêm env="production" và team="devops".
​
---

Khi Prometheus scrape một target, mặc định nó sẽ gọi HTTP GET đến endpoint có cấu trúc: `{scheme}://{address}{metrics_path}.`. Hoặc nếu có target và module thì sẽ gọi `{scheme}://{address}/{metrics_path}?target=<target>&module=<module_name>&[các_param_khác...]`
​
VD với target có các label mặc định → Prometheus sẽ gọi: `http://10.10.10.10:9100/metrics`

Nếu có query parameters (__param_*)  chúng sẽ được thêm vào URL như query string. VD target có query param là __param_target thì url sẽ thêm ?target=giá_trị, target có quert param là __param_module thì url sẽ thêm ?module=giá_trị

​Kiểm tra thực tế: Trong Targets page (/targets), mỗi target sẽ hiển thị "Scrape URL" chính xác mà Prometheus đang gọi.

Ví dụ cụ thể `GET http://188.40.137.145:9115/metrics?target=10.10.10.10:80`

Ví dụ cụ thể với Blackbox Exporter `GET http://188.40.137.145:9115/probe?target=10.10.10.10:80&module=http_2xx`
​
Cách tạo __param_module: Có 2 cách chính để đưa module vào URL:

1. Dùng params trong scrape_configs
```
scrape_configs:
  - job_name: 'blackbox'
    metrics_path: /probe
    params:
      module: [http_2xx]     # ← Tạo __param_module = "http_2xx"
    static_configs:
      - targets: ['example.com']
```
→ Prometheus tự tạo __param_module.
​

2. Dùng relabel_configs
```
relabel_configs:
  - replacement: http_2xx         # ← Giá trị cố định
    target_label: __param_module  # ← Tạo query param
```
→ URL sẽ có ?module=http_2xx.
​

Ví dụ với Blackbox
```
scrape_configs:
  - job_name: 'blackbox'
    metrics_path: /probe
    params:
      module: [http_2xx]          # Tạo __param_module
    static_configs:
      - targets: ['prometheus.io']
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target  # Tạo ?target=prometheus.io
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: 188.40.137.145:9115
```
→ URL thực tế Prometheus gọi `http://188.40.137.145:9115/probe?target=prometheus.io&module=http_2xx` → Blackbox exporter sẽ dùng module=http_2xx để biết dùng config nào (HTTP probe expect 2xx) và target=prometheus.io để probe endpoint đó.
​

Thứ tự query parameters: Prometheus sắp xếp theo thứ tự alphabet của param name: module trước target. Nhưng exporter thường không quan tâm thứ tự, chỉ parse theo tên param.
​

`GET http://188.40.137.145:9115/probe?target=10.10.10.10:80&module=http_2xx` giống với `GET http://188.40.137.145:9115/probe?module=http_2xx&target=10.10.10.10:80`
​
