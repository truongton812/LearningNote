# App Engine

Google App Engine (GAE) là một nền tảng đám mây (Platform as a Service - PaaS) do Google cung cấp, cho phép các nhà phát triển xây dựng và triển khai các ứng dụng web hoặc backend mà không cần quản lý cơ sở hạ tầng máy chủ vật lý hoặc ảo hóa.​


App Engine cung cấp môi trường lập trình, kho dữ liệu, thư viện, và dịch vụ tích hợp sẵn để bạn có thể viết, chạy và mở rộng ứng dụng ngay trên hạ tầng của Google.​

Việc triển khai ứng dụng đơn giản, chỉ cần tải mã nguồn lên và Google sẽ tự động lo về vấn đề cân bằng tải, autoscaling, cập nhật phiên bản cũng như giám sát tài nguyên.​

App Engine phù hợp cho nhiều loại ngôn ngữ lập trình hiện đại như Java, Python, Node.js, Go, PHP, Ruby, C#, .NET, và còn hỗ trợ thêm custom runtime qua Docker.​


App engine bound với region


## Tính năng nổi bật

Không cần quản lý máy chủ: Toàn bộ phần backend, bảo trì hệ điều hành, cập nhật phần mềm… đều do Google xử lý.​

Tự động mở rộng: App Engine tự động tăng/giảm số lượng instance đang chạy dựa trên lưu lượng truy cập thực tế, giúp tối ưu chi phí và hiệu năng.​

Thanh toán pay-as-you-go: Bạn chỉ phải trả phí theo tài nguyên thực sử dụng khi ứng dụng có người dùng truy cập.​

Tích hợp API mạnh mẽ: Dễ dàng dùng thêm các dịch vụ của Google như Cloud Storage, Memcache, Cloud Endpoints, BigQuery… hoặc kết nối với API bên ngoài chỉ với vài dòng lệnh.​

Quản lý phiên bản: Hệ thống cho phép deploy nhiều version ứng dụng cùng lúc, tiện lợi cho việc A/B testing, rollback, thử nghiệm dịch vụ mới.​

Giám sát và logging: Hỗ trợ Cloud Monitoring, Logging để kiểm soát, phát hiện và khắc phục lỗi nhanh chóng.​

## Các thành phần chính

Application: là container to nhất chứa tất cả, mỗi Project chỉ có 1 Application 

Service: là các microservices hoặc app components. Mỗi app có thể chứa nhiều service, mỗi service có thể chạy runtime/ngôn ngữ riêng.​

Version: Mỗi service có thể triển khai nhiều version khác nhau, mỗi version là 1 code và configuration

Instance: Một version của service có thể chạy nhiều instance song song để đáp ứng tải. Có thể có nhiều version chạy đồng thời 

<img width="747" height="382" alt="image" src="https://github.com/user-attachments/assets/9b31a437-0399-4d5b-9d8d-ebee2e037725" />


---

Google App Engine có hai môi trường chính cho việc chạy ứng dụng là Standard Environment (Môi trường tiêu chuẩn) và Flexible Environment (Môi trường linh hoạt), mỗi môi trường có những đặc điểm và ưu nhược điểm riêng thích hợp cho các loại ứng dụng khác nhau.​

App Engine Standard Environment
Chạy các ứng dụng trong một sandbox có giới hạn nhằm bảo đảm tính an toàn và đồng nhất.

Khởi động instance cực nhanh, chỉ trong vài giây.

Thích hợp cho các ứng dụng web có lưu lượng biến động cao, cần mở rộng nhanh.


Giới hạn về thư viện, runtime (hỗ trợ Java, Python, PHP, NodeJS, Ruby, Go, cần check thêm), và không cho phép chạy các tiến trình nền dài hoặc truy cập hệ thống file tùy ý.

Thời gian tối đa cho một request phụ thuộc vào runtime, thường ngắn hơn Flexible.

Tự động mở rộng về số lượng instance dựa trên lưu lượng truy cập.

Có hỗ trợ các API tích hợp sẵn của Google, rất tiện ích cho phát triển nhanh.

Không hỗ trợ truy cập SSH vào instance.​

App Engine Flexible Environment

Chạy ứng dụng trong các containers Docker trên VM của Compute Engine.

Khởi động instance chậm hơn so với Standard, mất vài phút vì phải khởi tạo VM.

Linh hoạt hơn, cho phép sử dụng custom runtime (bất kỳ runtime nào), các thư viện native, và các tiến trình nền dài.

Có thể truy cập root và SSH vào các VM nếu cần thiết để debug hoặc setup đặc thù.

Hỗ trợ cấu hình CPU, bộ nhớ, và các tài nguyên khác theo nhu cầu ứng dụng.

Tự động mở rộng nhưng phù hợp cho các ứng dụng có lưu lượng ổn định hoặc tăng giảm dần.

Thời gian xử lý request tối đa lên tới 60 phút, phù hợp cho các tác vụ phức tạp, lâu dài.

Thường được dùng cho các ứng dụng phức tạp hơn, có yêu cầu cao về môi trường runtime hoặc thư viện đặc biệt

| Đặc điểm                  | Standard Environment        | Flexible Environment        |
|--------------------------|-----------------------------|-----------------------------|
| Startup instance         | Vài giây                    | Vài phút                    |
| Thời gian tối đa request  | Ngắn (runtime-dependent)    | Lên đến 60 phút             |
| Hỗ trợ tiến trình nền     | Có, nhưng có giới hạn       | Có, không giới hạn          |
| SSH/root access           | Không                       | Có thể bật                  |
| Môi trường runtime        | Bị giới hạn, Google quản lý | Tùy chỉnh, Docker container |
| Loại ứng dụng phù hợp     | Ứng dụng web nhỏ, vừa       | Ứng dụng yêu cầu tùy chỉnh  |
| Tự động mở rộng           | Tự động, nhanh              | Tự động, phù hợp lưu lượng ổn định |



App Engine Standard phù hợp khi cần nhanh, đơn giản, ít tùy biến, còn Flexible phù hợp khi cần nhiều quyền tùy chỉnh và sử dụng tài nguyên phức tạp hơn trong GCP.​

---

Trong dự án App Engine, bạn xác định môi trường trong file cấu hình deployment, thường là file app.yaml. -> có vẻ không đúng, do trong bài giảng thì app engine environment được xác định ngay khi tạo application

Ví dụ với Standard Environment, file app.yaml sẽ có cấu hình mặc định hoặc không cần khai báo loại môi trường.

Với Flexible Environment, bạn cần khai báo env: flex trong app.yaml. Ví dụ:

```
runtime: python39
env: flex
```


---

Cấu trúc thư mục cho các service trong Google App Engine nên được tổ chức rõ ràng, mỗi service tách riêng biệt và có file cấu hình riêng đi kèm mã nguồn của service đó. Thư mục gốc của ứng dụng sẽ chứa các thư mục con, mỗi thư mục là một service với file app.yaml riêng biệt cho từng service.

```
my-app/
├── dispatch.yaml            # (Tùy chọn) cấu hình định tuyến chung cho toàn app
├── service1/
│   ├── app.yaml            # Cấu hình cho service1
│   ├── main.py             # File mã nguồn chính của service1 (hoặc index.js, ...)
│   └── ...                 # Các file khác phục vụ service1
├── service2/
│   ├── app.yaml
│   ├── main.py
│   └── ...
└── service3/
    ├── app.yaml
    ├── main.py
    └── ...
```




Lưu ý cấu trúc service trong App Engine

- File app.yaml trong mỗi service phải đặt thuộc thư mục của service đó và có trường service: <tên_service>. Nếu không chỉ định tên service thì code sẽ deploy vào default service

- Application của App Engine bắt buộc phải có default service

- Các version khác nhau của một service có thể sử dụng nhiều file yaml trong cùng thư mục.

- Service mặc định (“default”) luôn bắt buộc phải có và thường được định nghĩa trong app.yaml ở thư mục gốc hoặc thư mục riêng


Để deploy service App Engine dùng lệnh `gcloud app deploy`, có thể thêm option `--version=<version>` để chỉ định version, nếu không chỉ định thì GCP sẽ tự động generate, có thể thêm option `--no-promote` để chỉ định chỉ deploy code lên chứ không shift traffic (mặc định là --promote)

Khi thực hiện deploy lên version mới thì mặc định traffic sẽ switch over toàn bộ sang version mới, còn nếu chưa promote lên version mới mà muốn sử dụng tính năng split traffic thì dùng lệnh `gcloud app services set-traffic --split=v3=.5,v2=.5` (nghĩa là 50% đi vào v2, 50% đi vào v3)

Khi ta thực hiện deploy 1 service lên App Engine thì deployment package (app.yaml, code, dependencies,..) sẽ được lưu vào trong Google Cloud Storage và dịch vụ Cloud Build sẽ run CICD pipeline để thực hiện deploy ứng dụng -> CloudBuild cần quyền để access GCS (ít nhất là quyền viewer)


Để list các services dùng lệnh `gcloud app services list`

Để list các versions dùng lệnh `gcloud app versions list`

Để list các instances dùng lệnh `gcloud app instances list`

Để lấy link của active version của default service dùng lệnh `gcloud app browse`, thêm option `--version=<version>` để lấy link của 1 version cụ thể

Để lấy link của active version của các service khác dùng lệnh `gcloud app browse --service=<service_name>`


---

<img width="1793" height="965" alt="image" src="https://github.com/user-attachments/assets/b7be9668-c1bf-4979-b4a5-cd401a71075c" />

<img width="1512" height="803" alt="image" src="https://github.com/user-attachments/assets/84ca9110-1abd-411c-9206-68143470489c" />


