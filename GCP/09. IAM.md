# Identity Access Management


## 1. Role
Role là *set các permissions*. Trong GCP có 3 loại role:
- Basic roles (hay còn gọi là Primitive roles). Là các role đầu tiên của GCP, gồm 3 role là Owner, Editor và Viewer. Lưu ý không nên dùng basic role trong production
  - View (roles.viewer): chỉ có quyền đọc
  - Editor (roles.editor): có quyền đọc và sửa
  - Owner (roles.owner): có quyền sửa, quản lý roles/permision, quản lý billing
- Predefined roles: là các role quản lý bởi Google, giới hạn quyền trên từng service cụ thể. Ví dụ:
  - storage admin (roles/storage.admin): quản lý bucket và object trong Cloud Storage
  - storage object admin (roles/storage.objectAdmin): quản lý object trong bucket của Cloud Storage
  - storage object viewer (roles/storage.objectViewer): chỉ có quyền xem các object trong bucket của Cloud Storage
- Custom role: role do người dùng tự define


## 2. Policy
- Policy là đối tượng dạng YAML/JSON dùng để assign role cho principal. Để cấp quyền cho 1 principal thì cần tạo policy để bindings principal với role. Policy kế thừa theo hierarchy (từ organization xuống resource con) và hỗ trợ IAM Conditions để kiểm soát có điều kiện
- Truy cập IAM & Admin > IAM trong Google Cloud Console để xem danh sách tất cả principal, roles và bindings cho project hiện tại. Hoặc xem Policy của project hiện tại bằng lệnh `gcloud projects get-iam-policy <PROJECT_ID>`
- Có thể assign nhiều role cho 1 principal chỉ bằng 1 policy
- Ví dụ policy dạng json
```
{
  "bindings": [
    {
      "role": "roles/storage.objectAdmin",
      "members": [
        "user:you@in28minutes.com",
        "serviceAccount:myAppName@appspot.gserviceaccount.com",
        "group:administrators@in28minutes.com",
        "domain:google.com"
      ]
    },
    {
      "role": "roles/storage.objectViewer",
      "members": [
        "user:you@in28minutes.com"
      ],
      "condition": {
        "title": "Limited time access",
        "description": "Only upto Feb 2022",
        "expression": "request.time < timestamp('2022-02-01T00:00:00.000Z')"
      }
    }
  ]
}
```

## 3. Principal (hay còn gọi là Member)
- Principal đại diện 1 identity đã xác thực như người dùng Google, service account, nhóm hoặc domain. 
- Trong GCP ta không cấp quyền trực tiếp cho principal mà phải thông qua role trong policy.​
