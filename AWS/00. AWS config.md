`aws configure --profile my-user`

-> dùng để cấu hình một profile AWS CLI tên là my-user, cho phép bạn lưu thông tin xác thực (access key, secret key), vùng (region), và định dạng đầu ra cho một tài khoản AWS cụ thể ngoài profile mặc định.​

Thông tin xác thực được lưu trong mục [my-user] của thư mục ~/.aws/credentials

Sau khi cấu hình, bạn có thể thực thi các lệnh AWS CLI dưới profile này bằng cách thêm --profile my-user vào câu lệnh hoặc đặt biến môi trường AWS_PROFILE=my-user.​ VD `aws s3 ls --profile my-user`

Với profile này, bạn dễ dàng quản lý nhiều tài khoản/môi trường AWS trên cùng một máy mà không phải ghi đè hoặc thay đổi thông tin mặc định mỗi lần chuyển đổi.​

`aws configure list-profiles` : list tất cả profile hiện tại

`aws configure list --profile profilename` : xem chi tiết cấu hình hiện tại của một profile cụ thể

`aws sts get-caller-identity --profile my-user`

`aws sts get-caller-identity` dùng để kiểm tra xem bạn đang sử dụng danh tính AWS nào khi gọi dịch vụ, đặc biệt trong môi trường có nhiều profile hoặc credentials khác nhau. Lệnh không yêu cầu quyền đặc biệt nào để thực thi, vì vậy bạn có thể dùng nó để xác thực nhanh cấu hình profile AWS CLI của mình mà không sợ lỗi quyền. Khi thêm tùy chọn `--profile my-user"`, câu lệnh sẽ sử dụng cấu hình và credentials của profile tên "my-user" đã được thiết lập trước đó để lấy thông tin về danh tính IAM (IAM user hoặc IAM role) mà credentials của profile "my-user" dùng để xác thực khi gọi các dịch vụ AWS. Câu lệnh này sẽ trả về ba thông tin chính:

- UserId: mã định danh duy nhất của thực thể gọi (user hoặc role)

- Account: số tài khoản AWS chứa thực thể đó

- Arn: ARN (Amazon Resource Name) đầy đủ liên kết với thực thể gọi

---

```
[profile terraform-admin]
role_arn = arn:aws:iam::424432388155:role/terraform-admin
source_profile = my-user
```


Khai báo trong file ~/.aws/config như trên giúp cấu hình một profile IAM dùng để assume (nhận) một role thông qua một profile nguồn đã có sẵn credentials.

Giải thích từng dòng
[profile terraform-admin]

Đây là tên profile mà bạn sẽ sử dụng với CLI bằng cú pháp --profile terraform-admin.

role_arn = arn:aws:iam::424432388155:role/terraform-admin

Đây là ARN (Amazon Resource Name) của role mà bạn muốn assume. Khi sử dụng profile này, AWS CLI sẽ thực hiện lấy temporary credentials dựa vào quyền assume role được cấp.

source_profile = my-user

Đây là tên của profile đã cấu hình trước đó (thường có access key và secret key) trong file ~/.aws/credentials hoặc ~/.aws/config. Profile này phải được cấp quyền thực hiện lệnh sts:AssumeRole đối với role phía trên.

Quy trình sử dụng
Khi bạn chạy lệnh AWS CLI với --profile terraform-admin, CLI sẽ sử dụng thông tin từ profile my-user để gọi API STS AssumeRole lên role với ARN đã khai báo.

Nếu thành công, tạm thời profile CLI của bạn sẽ có những quyền được định nghĩa bởi role terraform-admin.

Đây là cách quản lý secure access khi làm việc với nhiều AWS Account hoặc cần phân tách quyền giữa users và roles.
